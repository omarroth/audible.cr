require "./spec_helper"

describe Audible do
  describe "#encrypt" do
    it "encrypts tracking metadata" do
      plaintext = %({"start":1549603736100,"interaction":{"keys":2,"keyPressTimeIntervals":[3061,6],"copies":0,"cuts":0,"pastes":0,"clicks":5,"touches":0,"mouseClickPositions":["744,188","736,179","690,223","376,233","813,286"],"keyCycles":[4,2],"mouseCycles":[59,47,92,78,39]},"version":"3.0.0","lsUbid":"X42-3760865-9592102:1549593713","timeZone":-6,"scripts":{"dynamicUrls":["https://images-na.ssl-images-amazon.com/images/G/01/AUIClients/ClientSideMetricsAUIJavascript@jserrorsForester.10f2559e93ec589d92509318a7e2acbac74c343a._V2_.js","https://images-na.ssl-images-amazon.com/images/I/61HHaoAEflL._RC|11-BZEJ8lnL.js,61q-U9rAZ3L.js,31x4ENTlVIL.js,31f4+QIEeqL.js,01N6xzIJxbL.js,518BI433aLL.js,01rpauTep4L.js,31QZSjMuoeL.js,61ofwvddDeL.js,01KsMxlPtzL.js_.js?AUIClients/AmazonUI","https://images-na.ssl-images-amazon.com/images/I/21T7I7qVEeL._RC|21T1XtqIBZL.js,21WEJWRAQlL.js,31DwnWh8lFL.js,21VKEfzET-L.js,01fHQhWQYWL.js,51Hqf9CH0tL.js_.js?AUIClients/AuthenticationPortalAssets","https://images-na.ssl-images-amazon.com/images/I/0173Lf6yxEL.js?AUIClients/AuthenticationPortalInlineAssets","https://images-na.ssl-images-amazon.com/images/I/21X0WwTcvbL.js?AUIClients/CVFAssets","https://images-na.ssl-images-amazon.com/images/G/01/x-locale/common/login/fwcim._CB457517591_.js"],"inlineHashes":[-1746719145,-1818136672,-314038750,-1809046278,2118203618,318224283,-1228118292,-1611905557,1800521327,-1171760960,-514826685],"elapsed":22,"dynamicUrlCount":6,"inlineHashesCount":11},"plugins":"Chrome PDF Plugin Chrome PDF Viewer Native Client ||1600-900-900-24-*-*-*","dupedPlugins":"Chrome PDF Plugin Chrome PDF Viewer Native Client ||1600-900-900-24-*-*-*","screenInfo":"1600-900-900-24-*-*-*","capabilities":{"js":{"audio":true,"geolocation":true,"localStorage":"supported","touch":false,"video":true,"webWorker":true},"css":{"textShadow":true,"textStroke":true,"boxShadow":true,"borderRadius":true,"borderImage":true,"opacity":true,"transform":true,"transition":true},"elapsed":0},"referrer":"https://www.amazon.com/","userAgent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.96 Safari/537.36","location":"https://www.amazon.com/ap/signin?openid.return_to=https%3A%2F%2Fwww.amazon.com%2F%3Fref_%3Dnav_ya_signin&openid.identity=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.assoc_handle=usflex&openid.mode=checkid_setup&openid.claimed_id=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.ns=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0&&openid.pape.max_auth_age=0","webDriver":null,"history":{"length":3},"gpu":{"vendor":"X.Org","model":"AMD JUNIPER (DRM 2.50.0 / 4.20.6-arch1-1-ARCH, LLVM 7.0.1)","extensions":["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_frag_depth","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","WEBKIT_EXT_texture_filter_anisotropic","EXT_sRGB","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_s3tc","WEBKIT_WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture","WEBGL_draw_buffers","WEBGL_lose_context","WEBKIT_WEBGL_lose_context"]},"battery":{"charging":true,"level":1,"chargingTime":0,"dischargingTime":-1},"dnt":null,"math":{"tan":"-1.4214488238747245","sin":"0.8178819121159085","cos":"-0.5753861119575491"},"performance":{"timing":{"navigationStart":1549603734585,"unloadEventStart":1549603735458,"unloadEventEnd":1549603735459,"redirectStart":0,"redirectEnd":0,"fetchStart":1549603734586,"domainLookupStart":1549603734586,"domainLookupEnd":1549603734586,"connectStart":1549603734586,"connectEnd":1549603734586,"secureConnectionStart":0,"requestStart":1549603734590,"responseStart":1549603735451,"responseEnd":1549603735843,"domLoading":1549603735470,"domInteractive":1549603736045,"domContentLoadedEventStart":1549603736045,"domContentLoadedEventEnd":1549603736047,"domComplete":1549603736050,"loadEventStart":1549603736050,"loadEventEnd":1549603736054}},"end":1549604033967,"ciba":{"events":[{"startTime":543,"time":547,"type":"k"},{"startTime":549,"time":551,"type":"k"},{"time":554,"type":"mm","x":691,"y":238},{"time":778,"type":"mm","x":690,"y":237},{"time":888,"type":"mm","x":690,"y":224},{"time":1039,"type":"mm","x":690,"y":223},{"startTime":993,"time":1085,"type":"m"},{"time":1142,"type":"mm","x":690,"y":223},{"time":1255,"type":"mm","x":702,"y":247},{"time":1411,"type":"mm","x":647,"y":295},{"time":1521,"type":"mm","x":376,"y":234},{"startTime":1582,"time":1660,"type":"m"},{"time":1688,"type":"mm","x":377,"y":233},{"time":1788,"type":"mm","x":481,"y":242},{"time":1889,"type":"mm","x":655,"y":277},{"time":2007,"type":"mm","x":727,"y":295},{"time":2410,"type":"mm","x":728,"y":294},{"time":2521,"type":"mm","x":1417,"y":219},{"time":22606,"type":"mm","x":1572,"y":336},{"time":22706,"type":"mm","x":959,"y":204},{"time":22817,"type":"mm","x":941,"y":203},{"time":22923,"type":"mm","x":884,"y":251},{"time":23041,"type":"mm","x":818,"y":311},{"time":23167,"type":"mm","x":810,"y":320},{"time":23272,"type":"mm","x":788,"y":283},{"time":24142,"type":"mm","x":806,"y":538},{"time":24283,"type":"mm","x":807,"y":537},{"time":24691,"type":"mm","x":814,"y":538},{"time":24805,"type":"mm","x":913,"y":486},{"time":24905,"type":"mm","x":988,"y":463},{"time":25005,"type":"mm","x":995,"y":438},{"time":25105,"type":"mm","x":926,"y":323},{"time":25206,"type":"mm","x":856,"y":282},{"time":25306,"type":"mm","x":827,"y":288},{"time":25422,"type":"mm","x":813,"y":286},{"time":25586,"type":"mm","x":813,"y":286},{"startTime":25590,"time":25629,"type":"m"}],"start":1549603738619},"errors":[],"metrics":[{"n":"fwcim-instant-collector","t":0},{"n":"fwcim-element-telemetry-collector","t":1},{"n":"fwcim-script-version-collector","t":0},{"n":"fwcim-local-storage-identifier-collector","t":0},{"n":"fwcim-timezone-collector","t":1},{"n":"fwcim-script-collector","t":0},{"n":"fwcim-plugin-collector","t":0},{"n":"fwcim-capability-collector","t":0},{"n":"fwcim-browser-collector","t":0},{"n":"fwcim-history-collector","t":0},{"n":"fwcim-gpu-collector","t":2},{"n":"fwcim-battery-collector","t":1},{"n":"fwcim-dnt-collector","t":0},{"n":"fwcim-math-fingerprint-collector","t":0},{"n":"fwcim-performance-collector","t":0},{"n":"fwcim-timer-collector","t":0},{"n":"fwcim-ciba-collector","t":1},{"n":"fwcim-timer-collector","t":0}]})
      metadata = %(ECdITeCs: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)
      encrypt_metadata(plaintext).should eq(metadata)

      plaintext = %({"start":1549596260610,"interaction":{"keys":2,"keyPressTimeIntervals":[4590,6],"copies":0,"cuts":0,"pastes":0,"clicks":6,"touches":0,"mouseClickPositions":["518,227","728,150","728,150","703,191","697,176","717,289"],"keyCycles":[4,3],"mouseCycles":[86,87,42,87,101]},"version":"3.0.0","lsUbid":"X42-3760865-9592102:1549593713","timeZone":-6,"scripts":{"dynamicUrls":["https://images-na.ssl-images-amazon.com/images/G/01/AUIClients/ClientSideMetricsAUIJavascript@jserrorsForester.10f2559e93ec589d92509318a7e2acbac74c343a._V2_.js","https://images-na.ssl-images-amazon.com/images/I/61HHaoAEflL._RC|11-BZEJ8lnL.js,61q-U9rAZ3L.js,31x4ENTlVIL.js,31f4+QIEeqL.js,01N6xzIJxbL.js,518BI433aLL.js,01rpauTep4L.js,31QZSjMuoeL.js,61ofwvddDeL.js,01KsMxlPtzL.js_.js?AUIClients/AmazonUI","https://images-na.ssl-images-amazon.com/images/I/21T7I7qVEeL._RC|21T1XtqIBZL.js,21WEJWRAQlL.js,31DwnWh8lFL.js,21VKEfzET-L.js,01fHQhWQYWL.js,51Hqf9CH0tL.js_.js?AUIClients/AuthenticationPortalAssets","https://images-na.ssl-images-amazon.com/images/I/0173Lf6yxEL.js?AUIClients/AuthenticationPortalInlineAssets","https://images-na.ssl-images-amazon.com/images/I/21X0WwTcvbL.js?AUIClients/CVFAssets","https://images-na.ssl-images-amazon.com/images/G/01/x-locale/common/login/fwcim._CB457517591_.js"],"inlineHashes":[-1746719145,1404169287,-314038750,-1809046278,2118203618,318224283,-1228118292,-1611905557,1800521327,-1171760960,-514826685],"elapsed":22,"dynamicUrlCount":6,"inlineHashesCount":11},"plugins":"Chrome PDF Plugin Chrome PDF Viewer Native Client ||1600-900-900-24-*-*-*","dupedPlugins":"Chrome PDF Plugin Chrome PDF Viewer Native Client ||1600-900-900-24-*-*-*","screenInfo":"1600-900-900-24-*-*-*","capabilities":{"js":{"audio":true,"geolocation":true,"localStorage":"supported","touch":false,"video":true,"webWorker":true},"css":{"textShadow":true,"textStroke":true,"boxShadow":true,"borderRadius":true,"borderImage":true,"opacity":true,"transform":true,"transition":true},"elapsed":150715},"referrer":"https://www.amazon.com/","userAgent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.96 Safari/537.36","location":"https://www.amazon.com/ap/signin?openid.return_to=https%3A%2F%2Fwww.amazon.com%2F%3F_encoding%3DUTF8%26opf_redir%3D1%26ref_%3Dnav_ya_signin&openid.identity=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.assoc_handle=usflex&openid.mode=checkid_setup&openid.claimed_id=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.ns=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0&&openid.pape.max_auth_age=0","webDriver":null,"history":{"length":16},"gpu":{"vendor":"X.Org","model":"AMD JUNIPER (DRM 2.50.0 / 4.20.6-arch1-1-ARCH, LLVM 7.0.1)","extensions":["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_frag_depth","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","WEBKIT_EXT_texture_filter_anisotropic","EXT_sRGB","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_s3tc","WEBKIT_WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture","WEBGL_draw_buffers","WEBGL_lose_context","WEBKIT_WEBGL_lose_context"]},"battery":{"charging":true,"level":1,"chargingTime":0,"dischargingTime":-1},"dnt":null,"math":{"tan":"-1.4214488238747245","sin":"0.8178819121159085","cos":"-0.5753861119575491"},"performance":{"timing":{"navigationStart":1549596258786,"unloadEventStart":1549596259437,"unloadEventEnd":1549596259437,"redirectStart":0,"redirectEnd":0,"fetchStart":1549596258787,"domainLookupStart":1549596258787,"domainLookupEnd":1549596258787,"connectStart":1549596258787,"connectEnd":1549596258787,"secureConnectionStart":0,"requestStart":1549596258792,"responseStart":1549596259430,"responseEnd":1549596260567,"domLoading":1549596259444,"domInteractive":1549596260577,"domContentLoadedEventStart":1549596260577,"domContentLoadedEventEnd":1549596260580,"domComplete":1549596260581,"loadEventStart":1549596260581,"loadEventEnd":1549596260586}},"end":1549598669893,"ciba":{"events":[{"time":24,"type":"mm","x":956,"y":264},{"time":146,"type":"mm","x":939,"y":261},{"time":252,"type":"mm","x":744,"y":212},{"time":367,"type":"mm","x":728,"y":163},{"startTime":469,"time":556,"type":"m"},{"time":602,"type":"mm","x":728,"y":151},{"time":717,"type":"mm","x":722,"y":168},{"time":862,"type":"mm","x":721,"y":170},{"time":967,"type":"mm","x":703,"y":191},{"startTime":969,"time":1011,"type":"m"},{"time":1068,"type":"mm","x":694,"y":197},{"time":1184,"type":"mm","x":697,"y":181},{"startTime":1249,"time":1336,"type":"m"},{"time":1602,"type":"mm","x":698,"y":177},{"startTime":2077,"time":2081,"type":"k"},{"startTime":2083,"time":2086,"type":"k"},{"time":2089,"type":"mm","x":734,"y":238},{"time":2200,"type":"mm","x":734,"y":240},{"time":2300,"type":"mm","x":732,"y":269},{"time":2400,"type":"mm","x":728,"y":283},{"time":2501,"type":"mm","x":718,"y":303},{"time":2642,"type":"mm","x":717,"y":303},{"time":2750,"type":"mm","x":717,"y":290},{"startTime":3943,"time":4044,"type":"m"}],"start":1549596263124},"errors":[],"metrics":[{"n":"fwcim-instant-collector","t":68118},{"n":"fwcim-element-telemetry-collector","t":716877},{"n":"fwcim-script-version-collector","t":29345},{"n":"fwcim-local-storage-identifier-collector","t":210133},{"n":"fwcim-timezone-collector","t":39616},{"n":"fwcim-script-collector","t":418369},{"n":"fwcim-plugin-collector","t":174718},{"n":"fwcim-capability-collector","t":357455},{"n":"fwcim-browser-collector","t":37203},{"n":"fwcim-history-collector","t":36139},{"n":"fwcim-gpu-collector","t":58109},{"n":"fwcim-battery-collector","t":0},{"n":"fwcim-dnt-collector","t":0},{"n":"fwcim-math-fingerprint-collector","t":0},{"n":"fwcim-performance-collector","t":0},{"n":"fwcim-timer-collector","t":0},{"n":"fwcim-ciba-collector","t":1},{"n":"fwcim-timer-collector","t":0}]})
      metadata = %(ECdITeCs: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)
      encrypt_metadata(plaintext).should eq(metadata)

      plaintext = %({"start":1549603736100,"interaction":{"keys":2,"keyPressTimeIntervals":[3061,6],"copies":0,"cuts":0,"pastes":0,"clicks":5,"touches":0,"mouseClickPositions":["744,188","736,179","690,223","376,233","813,286"],"keyCycles":[4,2],"mouseCycles":[59,47,92,78,39]},"version":"3.0.0","lsUbid":"X42-3760865-9592102:1549593713","timeZone":-6,"scripts":{"dynamicUrls":["https://images-na.ssl-images-amazon.com/images/G/01/AUIClients/ClientSideMetricsAUIJavascript@jserrorsForester.10f2559e93ec589d92509318a7e2acbac74c343a._V2_.js","https://images-na.ssl-images-amazon.com/images/I/61HHaoAEflL._RC|11-BZEJ8lnL.js,61q-U9rAZ3L.js,31x4ENTlVIL.js,31f4+QIEeqL.js,01N6xzIJxbL.js,518BI433aLL.js,01rpauTep4L.js,31QZSjMuoeL.js,61ofwvddDeL.js,01KsMxlPtzL.js_.js?AUIClients/AmazonUI","https://images-na.ssl-images-amazon.com/images/I/21T7I7qVEeL._RC|21T1XtqIBZL.js,21WEJWRAQlL.js,31DwnWh8lFL.js,21VKEfzET-L.js,01fHQhWQYWL.js,51Hqf9CH0tL.js_.js?AUIClients/AuthenticationPortalAssets","https://images-na.ssl-images-amazon.com/images/I/0173Lf6yxEL.js?AUIClients/AuthenticationPortalInlineAssets","https://images-na.ssl-images-amazon.com/images/I/21X0WwTcvbL.js?AUIClients/CVFAssets","https://images-na.ssl-images-amazon.com/images/G/01/x-locale/common/login/fwcim._CB457517591_.js"],"inlineHashes":[-1746719145,-1818136672,-314038750,-1809046278,2118203618,318224283,-1228118292,-1611905557,1800521327,-1171760960,-514826685],"elapsed":22,"dynamicUrlCount":6,"inlineHashesCount":11},"plugins":"Chrome PDF Plugin Chrome PDF Viewer Native Client ||1600-900-900-24-*-*-*","dupedPlugins":"Chrome PDF Plugin Chrome PDF Viewer Native Client ||1600-900-900-24-*-*-*","screenInfo":"1600-900-900-24-*-*-*","capabilities":{"js":{"audio":true,"geolocation":true,"localStorage":"supported","touch":false,"video":true,"webWorker":true},"css":{"textShadow":true,"textStroke":true,"boxShadow":true,"borderRadius":true,"borderImage":true,"opacity":true,"transform":true,"transition":true},"elapsed":0},"referrer":"https://www.amazon.com/","userAgent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.96 Safari/537.36","location":"https://www.amazon.com/ap/signin?openid.return_to=https%3A%2F%2Fwww.amazon.com%2F%3Fref_%3Dnav_ya_signin&openid.identity=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.assoc_handle=usflex&openid.mode=checkid_setup&openid.claimed_id=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.ns=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0&&openid.pape.max_auth_age=0","webDriver":null,"history":{"length":3},"gpu":{"vendor":"X.Org","model":"AMD JUNIPER (DRM 2.50.0 / 4.20.6-arch1-1-ARCH, LLVM 7.0.1)","extensions":["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_frag_depth","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","WEBKIT_EXT_texture_filter_anisotropic","EXT_sRGB","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_s3tc","WEBKIT_WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture","WEBGL_draw_buffers","WEBGL_lose_context","WEBKIT_WEBGL_lose_context"]},"battery":{"charging":true,"level":1,"chargingTime":0,"dischargingTime":-1},"dnt":null,"math":{"tan":"-1.4214488238747245","sin":"0.8178819121159085","cos":"-0.5753861119575491"},"performance":{"timing":{"navigationStart":1549603734585,"unloadEventStart":1549603735458,"unloadEventEnd":1549603735459,"redirectStart":0,"redirectEnd":0,"fetchStart":1549603734586,"domainLookupStart":1549603734586,"domainLookupEnd":1549603734586,"connectStart":1549603734586,"connectEnd":1549603734586,"secureConnectionStart":0,"requestStart":1549603734590,"responseStart":1549603735451,"responseEnd":1549603735843,"domLoading":1549603735470,"domInteractive":1549603736045,"domContentLoadedEventStart":1549603736045,"domContentLoadedEventEnd":1549603736047,"domComplete":1549603736050,"loadEventStart":1549603736050,"loadEventEnd":1549603736054}},"end":1549603764278,"timeToSubmit":28125,"form":{"email":{"keys":1,"keyPressTimeIntervals":[3034],"copies":0,"cuts":0,"pastes":0,"clicks":1,"touches":0,"mouseClickPositions":["84,27"],"keyCycles":[5],"mouseCycles":[47],"width":296,"height":31,"checksum":"C860E86B","time":2417,"autocomplete":false,"prefilled":false},"password":{"keys":1,"keyPressTimeIntervals":[3039],"copies":0,"cuts":0,"pastes":0,"clicks":1,"touches":0,"mouseClickPositions":["38,5"],"keyCycles":[3],"mouseCycles":[92],"width":296,"height":31,"time":589,"autocomplete":false,"prefilled":false}},"canvas":{"hash":1903229353,"emailHash":-1907348336,"histogramBins":[13144,64,79,75,49,54,62,54,47,47,61,28,52,41,57,56,53,32,34,37,54,21,42,31,31,41,24,43,36,28,49,38,36,40,34,28,28,31,40,45,52,26,22,33,29,28,25,38,44,34,32,50,28,17,19,25,35,31,31,34,20,20,45,35,55,48,30,29,18,20,26,27,30,29,29,26,21,16,29,36,55,34,24,27,17,38,33,32,25,29,34,38,39,39,40,21,54,31,55,69,63,84,434,37,30,20,18,27,40,50,32,40,35,33,24,52,39,48,36,40,48,24,47,45,34,19,44,78,273,76,46,35,30,28,33,38,45,31,35,32,30,26,31,39,50,17,33,46,29,16,27,50,30,63,30,42,25,18,23,23,28,20,32,44,24,30,31,21,45,42,27,46,16,17,29,36,30,23,19,16,28,23,19,35,22,17,26,20,15,23,18,57,30,21,21,32,28,36,31,23,44,25,35,58,56,53,29,55,33,49,19,30,30,25,18,42,51,28,26,46,23,35,27,43,40,34,35,38,26,34,36,43,31,35,38,33,35,51,40,69,65,47,29,40,45,53,53,59,63,49,64,57,80,79,111,12834]},"token":null,"errors":[],"metrics":[{"n":"fwcim-mercury-collector","t":0},{"n":"fwcim-instant-collector","t":0},{"n":"fwcim-element-telemetry-collector","t":0},{"n":"fwcim-script-version-collector","t":0},{"n":"fwcim-local-storage-identifier-collector","t":0},{"n":"fwcim-timezone-collector","t":1},{"n":"fwcim-script-collector","t":0},{"n":"fwcim-plugin-collector","t":0},{"n":"fwcim-capability-collector","t":0},{"n":"fwcim-browser-collector","t":0},{"n":"fwcim-history-collector","t":0},{"n":"fwcim-gpu-collector","t":3},{"n":"fwcim-battery-collector","t":0},{"n":"fwcim-dnt-collector","t":0},{"n":"fwcim-math-fingerprint-collector","t":0},{"n":"fwcim-performance-collector","t":0},{"n":"fwcim-timer-collector","t":0},{"n":"fwcim-time-to-submit-collector","t":0},{"n":"fwcim-form-input-telemetry-collector","t":1},{"n":"fwcim-canvas-collector","t":23},{"n":"fwcim-captcha-telemetry-collector","t":0},{"n":"fwcim-proof-of-work-collector","t":0},{"n":"fwcim-ubf-collector","t":0},{"n":"fwcim-timer-collector","t":0}]})
      metadata = %(ECdITeCs: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)
      encrypt_metadata(plaintext).should eq(metadata)
    end
  end

  describe "#decrypt" do
    it "decrypts tracking metadata" do
      plaintext = %({"start":1549603736100,"interaction":{"keys":2,"keyPressTimeIntervals":[3061,6],"copies":0,"cuts":0,"pastes":0,"clicks":5,"touches":0,"mouseClickPositions":["744,188","736,179","690,223","376,233","813,286"],"keyCycles":[4,2],"mouseCycles":[59,47,92,78,39]},"version":"3.0.0","lsUbid":"X42-3760865-9592102:1549593713","timeZone":-6,"scripts":{"dynamicUrls":["https://images-na.ssl-images-amazon.com/images/G/01/AUIClients/ClientSideMetricsAUIJavascript@jserrorsForester.10f2559e93ec589d92509318a7e2acbac74c343a._V2_.js","https://images-na.ssl-images-amazon.com/images/I/61HHaoAEflL._RC|11-BZEJ8lnL.js,61q-U9rAZ3L.js,31x4ENTlVIL.js,31f4+QIEeqL.js,01N6xzIJxbL.js,518BI433aLL.js,01rpauTep4L.js,31QZSjMuoeL.js,61ofwvddDeL.js,01KsMxlPtzL.js_.js?AUIClients/AmazonUI","https://images-na.ssl-images-amazon.com/images/I/21T7I7qVEeL._RC|21T1XtqIBZL.js,21WEJWRAQlL.js,31DwnWh8lFL.js,21VKEfzET-L.js,01fHQhWQYWL.js,51Hqf9CH0tL.js_.js?AUIClients/AuthenticationPortalAssets","https://images-na.ssl-images-amazon.com/images/I/0173Lf6yxEL.js?AUIClients/AuthenticationPortalInlineAssets","https://images-na.ssl-images-amazon.com/images/I/21X0WwTcvbL.js?AUIClients/CVFAssets","https://images-na.ssl-images-amazon.com/images/G/01/x-locale/common/login/fwcim._CB457517591_.js"],"inlineHashes":[-1746719145,-1818136672,-314038750,-1809046278,2118203618,318224283,-1228118292,-1611905557,1800521327,-1171760960,-514826685],"elapsed":22,"dynamicUrlCount":6,"inlineHashesCount":11},"plugins":"Chrome PDF Plugin Chrome PDF Viewer Native Client ||1600-900-900-24-*-*-*","dupedPlugins":"Chrome PDF Plugin Chrome PDF Viewer Native Client ||1600-900-900-24-*-*-*","screenInfo":"1600-900-900-24-*-*-*","capabilities":{"js":{"audio":true,"geolocation":true,"localStorage":"supported","touch":false,"video":true,"webWorker":true},"css":{"textShadow":true,"textStroke":true,"boxShadow":true,"borderRadius":true,"borderImage":true,"opacity":true,"transform":true,"transition":true},"elapsed":0},"referrer":"https://www.amazon.com/","userAgent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.96 Safari/537.36","location":"https://www.amazon.com/ap/signin?openid.return_to=https%3A%2F%2Fwww.amazon.com%2F%3Fref_%3Dnav_ya_signin&openid.identity=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.assoc_handle=usflex&openid.mode=checkid_setup&openid.claimed_id=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.ns=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0&&openid.pape.max_auth_age=0","webDriver":null,"history":{"length":3},"gpu":{"vendor":"X.Org","model":"AMD JUNIPER (DRM 2.50.0 / 4.20.6-arch1-1-ARCH, LLVM 7.0.1)","extensions":["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_frag_depth","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","WEBKIT_EXT_texture_filter_anisotropic","EXT_sRGB","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_s3tc","WEBKIT_WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture","WEBGL_draw_buffers","WEBGL_lose_context","WEBKIT_WEBGL_lose_context"]},"battery":{"charging":true,"level":1,"chargingTime":0,"dischargingTime":-1},"dnt":null,"math":{"tan":"-1.4214488238747245","sin":"0.8178819121159085","cos":"-0.5753861119575491"},"performance":{"timing":{"navigationStart":1549603734585,"unloadEventStart":1549603735458,"unloadEventEnd":1549603735459,"redirectStart":0,"redirectEnd":0,"fetchStart":1549603734586,"domainLookupStart":1549603734586,"domainLookupEnd":1549603734586,"connectStart":1549603734586,"connectEnd":1549603734586,"secureConnectionStart":0,"requestStart":1549603734590,"responseStart":1549603735451,"responseEnd":1549603735843,"domLoading":1549603735470,"domInteractive":1549603736045,"domContentLoadedEventStart":1549603736045,"domContentLoadedEventEnd":1549603736047,"domComplete":1549603736050,"loadEventStart":1549603736050,"loadEventEnd":1549603736054}},"end":1549604033967,"ciba":{"events":[{"startTime":543,"time":547,"type":"k"},{"startTime":549,"time":551,"type":"k"},{"time":554,"type":"mm","x":691,"y":238},{"time":778,"type":"mm","x":690,"y":237},{"time":888,"type":"mm","x":690,"y":224},{"time":1039,"type":"mm","x":690,"y":223},{"startTime":993,"time":1085,"type":"m"},{"time":1142,"type":"mm","x":690,"y":223},{"time":1255,"type":"mm","x":702,"y":247},{"time":1411,"type":"mm","x":647,"y":295},{"time":1521,"type":"mm","x":376,"y":234},{"startTime":1582,"time":1660,"type":"m"},{"time":1688,"type":"mm","x":377,"y":233},{"time":1788,"type":"mm","x":481,"y":242},{"time":1889,"type":"mm","x":655,"y":277},{"time":2007,"type":"mm","x":727,"y":295},{"time":2410,"type":"mm","x":728,"y":294},{"time":2521,"type":"mm","x":1417,"y":219},{"time":22606,"type":"mm","x":1572,"y":336},{"time":22706,"type":"mm","x":959,"y":204},{"time":22817,"type":"mm","x":941,"y":203},{"time":22923,"type":"mm","x":884,"y":251},{"time":23041,"type":"mm","x":818,"y":311},{"time":23167,"type":"mm","x":810,"y":320},{"time":23272,"type":"mm","x":788,"y":283},{"time":24142,"type":"mm","x":806,"y":538},{"time":24283,"type":"mm","x":807,"y":537},{"time":24691,"type":"mm","x":814,"y":538},{"time":24805,"type":"mm","x":913,"y":486},{"time":24905,"type":"mm","x":988,"y":463},{"time":25005,"type":"mm","x":995,"y":438},{"time":25105,"type":"mm","x":926,"y":323},{"time":25206,"type":"mm","x":856,"y":282},{"time":25306,"type":"mm","x":827,"y":288},{"time":25422,"type":"mm","x":813,"y":286},{"time":25586,"type":"mm","x":813,"y":286},{"startTime":25590,"time":25629,"type":"m"}],"start":1549603738619},"errors":[],"metrics":[{"n":"fwcim-instant-collector","t":0},{"n":"fwcim-element-telemetry-collector","t":1},{"n":"fwcim-script-version-collector","t":0},{"n":"fwcim-local-storage-identifier-collector","t":0},{"n":"fwcim-timezone-collector","t":1},{"n":"fwcim-script-collector","t":0},{"n":"fwcim-plugin-collector","t":0},{"n":"fwcim-capability-collector","t":0},{"n":"fwcim-browser-collector","t":0},{"n":"fwcim-history-collector","t":0},{"n":"fwcim-gpu-collector","t":2},{"n":"fwcim-battery-collector","t":1},{"n":"fwcim-dnt-collector","t":0},{"n":"fwcim-math-fingerprint-collector","t":0},{"n":"fwcim-performance-collector","t":0},{"n":"fwcim-timer-collector","t":0},{"n":"fwcim-ciba-collector","t":1},{"n":"fwcim-timer-collector","t":0}]})
      metadata = %(ECdITeCs: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)
      decrypt_metadata(metadata).should eq(plaintext)

      plaintext = %({"start":1549596260610,"interaction":{"keys":2,"keyPressTimeIntervals":[4590,6],"copies":0,"cuts":0,"pastes":0,"clicks":6,"touches":0,"mouseClickPositions":["518,227","728,150","728,150","703,191","697,176","717,289"],"keyCycles":[4,3],"mouseCycles":[86,87,42,87,101]},"version":"3.0.0","lsUbid":"X42-3760865-9592102:1549593713","timeZone":-6,"scripts":{"dynamicUrls":["https://images-na.ssl-images-amazon.com/images/G/01/AUIClients/ClientSideMetricsAUIJavascript@jserrorsForester.10f2559e93ec589d92509318a7e2acbac74c343a._V2_.js","https://images-na.ssl-images-amazon.com/images/I/61HHaoAEflL._RC|11-BZEJ8lnL.js,61q-U9rAZ3L.js,31x4ENTlVIL.js,31f4+QIEeqL.js,01N6xzIJxbL.js,518BI433aLL.js,01rpauTep4L.js,31QZSjMuoeL.js,61ofwvddDeL.js,01KsMxlPtzL.js_.js?AUIClients/AmazonUI","https://images-na.ssl-images-amazon.com/images/I/21T7I7qVEeL._RC|21T1XtqIBZL.js,21WEJWRAQlL.js,31DwnWh8lFL.js,21VKEfzET-L.js,01fHQhWQYWL.js,51Hqf9CH0tL.js_.js?AUIClients/AuthenticationPortalAssets","https://images-na.ssl-images-amazon.com/images/I/0173Lf6yxEL.js?AUIClients/AuthenticationPortalInlineAssets","https://images-na.ssl-images-amazon.com/images/I/21X0WwTcvbL.js?AUIClients/CVFAssets","https://images-na.ssl-images-amazon.com/images/G/01/x-locale/common/login/fwcim._CB457517591_.js"],"inlineHashes":[-1746719145,1404169287,-314038750,-1809046278,2118203618,318224283,-1228118292,-1611905557,1800521327,-1171760960,-514826685],"elapsed":22,"dynamicUrlCount":6,"inlineHashesCount":11},"plugins":"Chrome PDF Plugin Chrome PDF Viewer Native Client ||1600-900-900-24-*-*-*","dupedPlugins":"Chrome PDF Plugin Chrome PDF Viewer Native Client ||1600-900-900-24-*-*-*","screenInfo":"1600-900-900-24-*-*-*","capabilities":{"js":{"audio":true,"geolocation":true,"localStorage":"supported","touch":false,"video":true,"webWorker":true},"css":{"textShadow":true,"textStroke":true,"boxShadow":true,"borderRadius":true,"borderImage":true,"opacity":true,"transform":true,"transition":true},"elapsed":150715},"referrer":"https://www.amazon.com/","userAgent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.96 Safari/537.36","location":"https://www.amazon.com/ap/signin?openid.return_to=https%3A%2F%2Fwww.amazon.com%2F%3F_encoding%3DUTF8%26opf_redir%3D1%26ref_%3Dnav_ya_signin&openid.identity=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.assoc_handle=usflex&openid.mode=checkid_setup&openid.claimed_id=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.ns=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0&&openid.pape.max_auth_age=0","webDriver":null,"history":{"length":16},"gpu":{"vendor":"X.Org","model":"AMD JUNIPER (DRM 2.50.0 / 4.20.6-arch1-1-ARCH, LLVM 7.0.1)","extensions":["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_frag_depth","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","WEBKIT_EXT_texture_filter_anisotropic","EXT_sRGB","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_s3tc","WEBKIT_WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture","WEBGL_draw_buffers","WEBGL_lose_context","WEBKIT_WEBGL_lose_context"]},"battery":{"charging":true,"level":1,"chargingTime":0,"dischargingTime":-1},"dnt":null,"math":{"tan":"-1.4214488238747245","sin":"0.8178819121159085","cos":"-0.5753861119575491"},"performance":{"timing":{"navigationStart":1549596258786,"unloadEventStart":1549596259437,"unloadEventEnd":1549596259437,"redirectStart":0,"redirectEnd":0,"fetchStart":1549596258787,"domainLookupStart":1549596258787,"domainLookupEnd":1549596258787,"connectStart":1549596258787,"connectEnd":1549596258787,"secureConnectionStart":0,"requestStart":1549596258792,"responseStart":1549596259430,"responseEnd":1549596260567,"domLoading":1549596259444,"domInteractive":1549596260577,"domContentLoadedEventStart":1549596260577,"domContentLoadedEventEnd":1549596260580,"domComplete":1549596260581,"loadEventStart":1549596260581,"loadEventEnd":1549596260586}},"end":1549598669893,"ciba":{"events":[{"time":24,"type":"mm","x":956,"y":264},{"time":146,"type":"mm","x":939,"y":261},{"time":252,"type":"mm","x":744,"y":212},{"time":367,"type":"mm","x":728,"y":163},{"startTime":469,"time":556,"type":"m"},{"time":602,"type":"mm","x":728,"y":151},{"time":717,"type":"mm","x":722,"y":168},{"time":862,"type":"mm","x":721,"y":170},{"time":967,"type":"mm","x":703,"y":191},{"startTime":969,"time":1011,"type":"m"},{"time":1068,"type":"mm","x":694,"y":197},{"time":1184,"type":"mm","x":697,"y":181},{"startTime":1249,"time":1336,"type":"m"},{"time":1602,"type":"mm","x":698,"y":177},{"startTime":2077,"time":2081,"type":"k"},{"startTime":2083,"time":2086,"type":"k"},{"time":2089,"type":"mm","x":734,"y":238},{"time":2200,"type":"mm","x":734,"y":240},{"time":2300,"type":"mm","x":732,"y":269},{"time":2400,"type":"mm","x":728,"y":283},{"time":2501,"type":"mm","x":718,"y":303},{"time":2642,"type":"mm","x":717,"y":303},{"time":2750,"type":"mm","x":717,"y":290},{"startTime":3943,"time":4044,"type":"m"}],"start":1549596263124},"errors":[],"metrics":[{"n":"fwcim-instant-collector","t":68118},{"n":"fwcim-element-telemetry-collector","t":716877},{"n":"fwcim-script-version-collector","t":29345},{"n":"fwcim-local-storage-identifier-collector","t":210133},{"n":"fwcim-timezone-collector","t":39616},{"n":"fwcim-script-collector","t":418369},{"n":"fwcim-plugin-collector","t":174718},{"n":"fwcim-capability-collector","t":357455},{"n":"fwcim-browser-collector","t":37203},{"n":"fwcim-history-collector","t":36139},{"n":"fwcim-gpu-collector","t":58109},{"n":"fwcim-battery-collector","t":0},{"n":"fwcim-dnt-collector","t":0},{"n":"fwcim-math-fingerprint-collector","t":0},{"n":"fwcim-performance-collector","t":0},{"n":"fwcim-timer-collector","t":0},{"n":"fwcim-ciba-collector","t":1},{"n":"fwcim-timer-collector","t":0}]})
      metadata = %(ECdITeCs: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)
      decrypt_metadata(metadata).should eq(plaintext)

      plaintext = %({"start":1549603736100,"interaction":{"keys":2,"keyPressTimeIntervals":[3061,6],"copies":0,"cuts":0,"pastes":0,"clicks":5,"touches":0,"mouseClickPositions":["744,188","736,179","690,223","376,233","813,286"],"keyCycles":[4,2],"mouseCycles":[59,47,92,78,39]},"version":"3.0.0","lsUbid":"X42-3760865-9592102:1549593713","timeZone":-6,"scripts":{"dynamicUrls":["https://images-na.ssl-images-amazon.com/images/G/01/AUIClients/ClientSideMetricsAUIJavascript@jserrorsForester.10f2559e93ec589d92509318a7e2acbac74c343a._V2_.js","https://images-na.ssl-images-amazon.com/images/I/61HHaoAEflL._RC|11-BZEJ8lnL.js,61q-U9rAZ3L.js,31x4ENTlVIL.js,31f4+QIEeqL.js,01N6xzIJxbL.js,518BI433aLL.js,01rpauTep4L.js,31QZSjMuoeL.js,61ofwvddDeL.js,01KsMxlPtzL.js_.js?AUIClients/AmazonUI","https://images-na.ssl-images-amazon.com/images/I/21T7I7qVEeL._RC|21T1XtqIBZL.js,21WEJWRAQlL.js,31DwnWh8lFL.js,21VKEfzET-L.js,01fHQhWQYWL.js,51Hqf9CH0tL.js_.js?AUIClients/AuthenticationPortalAssets","https://images-na.ssl-images-amazon.com/images/I/0173Lf6yxEL.js?AUIClients/AuthenticationPortalInlineAssets","https://images-na.ssl-images-amazon.com/images/I/21X0WwTcvbL.js?AUIClients/CVFAssets","https://images-na.ssl-images-amazon.com/images/G/01/x-locale/common/login/fwcim._CB457517591_.js"],"inlineHashes":[-1746719145,-1818136672,-314038750,-1809046278,2118203618,318224283,-1228118292,-1611905557,1800521327,-1171760960,-514826685],"elapsed":22,"dynamicUrlCount":6,"inlineHashesCount":11},"plugins":"Chrome PDF Plugin Chrome PDF Viewer Native Client ||1600-900-900-24-*-*-*","dupedPlugins":"Chrome PDF Plugin Chrome PDF Viewer Native Client ||1600-900-900-24-*-*-*","screenInfo":"1600-900-900-24-*-*-*","capabilities":{"js":{"audio":true,"geolocation":true,"localStorage":"supported","touch":false,"video":true,"webWorker":true},"css":{"textShadow":true,"textStroke":true,"boxShadow":true,"borderRadius":true,"borderImage":true,"opacity":true,"transform":true,"transition":true},"elapsed":0},"referrer":"https://www.amazon.com/","userAgent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.96 Safari/537.36","location":"https://www.amazon.com/ap/signin?openid.return_to=https%3A%2F%2Fwww.amazon.com%2F%3Fref_%3Dnav_ya_signin&openid.identity=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.assoc_handle=usflex&openid.mode=checkid_setup&openid.claimed_id=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.ns=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0&&openid.pape.max_auth_age=0","webDriver":null,"history":{"length":3},"gpu":{"vendor":"X.Org","model":"AMD JUNIPER (DRM 2.50.0 / 4.20.6-arch1-1-ARCH, LLVM 7.0.1)","extensions":["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_frag_depth","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","WEBKIT_EXT_texture_filter_anisotropic","EXT_sRGB","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_s3tc","WEBKIT_WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture","WEBGL_draw_buffers","WEBGL_lose_context","WEBKIT_WEBGL_lose_context"]},"battery":{"charging":true,"level":1,"chargingTime":0,"dischargingTime":-1},"dnt":null,"math":{"tan":"-1.4214488238747245","sin":"0.8178819121159085","cos":"-0.5753861119575491"},"performance":{"timing":{"navigationStart":1549603734585,"unloadEventStart":1549603735458,"unloadEventEnd":1549603735459,"redirectStart":0,"redirectEnd":0,"fetchStart":1549603734586,"domainLookupStart":1549603734586,"domainLookupEnd":1549603734586,"connectStart":1549603734586,"connectEnd":1549603734586,"secureConnectionStart":0,"requestStart":1549603734590,"responseStart":1549603735451,"responseEnd":1549603735843,"domLoading":1549603735470,"domInteractive":1549603736045,"domContentLoadedEventStart":1549603736045,"domContentLoadedEventEnd":1549603736047,"domComplete":1549603736050,"loadEventStart":1549603736050,"loadEventEnd":1549603736054}},"end":1549603764278,"timeToSubmit":28125,"form":{"email":{"keys":1,"keyPressTimeIntervals":[3034],"copies":0,"cuts":0,"pastes":0,"clicks":1,"touches":0,"mouseClickPositions":["84,27"],"keyCycles":[5],"mouseCycles":[47],"width":296,"height":31,"checksum":"C860E86B","time":2417,"autocomplete":false,"prefilled":false},"password":{"keys":1,"keyPressTimeIntervals":[3039],"copies":0,"cuts":0,"pastes":0,"clicks":1,"touches":0,"mouseClickPositions":["38,5"],"keyCycles":[3],"mouseCycles":[92],"width":296,"height":31,"time":589,"autocomplete":false,"prefilled":false}},"canvas":{"hash":1903229353,"emailHash":-1907348336,"histogramBins":[13144,64,79,75,49,54,62,54,47,47,61,28,52,41,57,56,53,32,34,37,54,21,42,31,31,41,24,43,36,28,49,38,36,40,34,28,28,31,40,45,52,26,22,33,29,28,25,38,44,34,32,50,28,17,19,25,35,31,31,34,20,20,45,35,55,48,30,29,18,20,26,27,30,29,29,26,21,16,29,36,55,34,24,27,17,38,33,32,25,29,34,38,39,39,40,21,54,31,55,69,63,84,434,37,30,20,18,27,40,50,32,40,35,33,24,52,39,48,36,40,48,24,47,45,34,19,44,78,273,76,46,35,30,28,33,38,45,31,35,32,30,26,31,39,50,17,33,46,29,16,27,50,30,63,30,42,25,18,23,23,28,20,32,44,24,30,31,21,45,42,27,46,16,17,29,36,30,23,19,16,28,23,19,35,22,17,26,20,15,23,18,57,30,21,21,32,28,36,31,23,44,25,35,58,56,53,29,55,33,49,19,30,30,25,18,42,51,28,26,46,23,35,27,43,40,34,35,38,26,34,36,43,31,35,38,33,35,51,40,69,65,47,29,40,45,53,53,59,63,49,64,57,80,79,111,12834]},"token":null,"errors":[],"metrics":[{"n":"fwcim-mercury-collector","t":0},{"n":"fwcim-instant-collector","t":0},{"n":"fwcim-element-telemetry-collector","t":0},{"n":"fwcim-script-version-collector","t":0},{"n":"fwcim-local-storage-identifier-collector","t":0},{"n":"fwcim-timezone-collector","t":1},{"n":"fwcim-script-collector","t":0},{"n":"fwcim-plugin-collector","t":0},{"n":"fwcim-capability-collector","t":0},{"n":"fwcim-browser-collector","t":0},{"n":"fwcim-history-collector","t":0},{"n":"fwcim-gpu-collector","t":3},{"n":"fwcim-battery-collector","t":0},{"n":"fwcim-dnt-collector","t":0},{"n":"fwcim-math-fingerprint-collector","t":0},{"n":"fwcim-performance-collector","t":0},{"n":"fwcim-timer-collector","t":0},{"n":"fwcim-time-to-submit-collector","t":0},{"n":"fwcim-form-input-telemetry-collector","t":1},{"n":"fwcim-canvas-collector","t":23},{"n":"fwcim-captcha-telemetry-collector","t":0},{"n":"fwcim-proof-of-work-collector","t":0},{"n":"fwcim-ubf-collector","t":0},{"n":"fwcim-timer-collector","t":0}]})
      metadata = %(ECdITeCs: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)
      decrypt_metadata(metadata).should eq(plaintext)
    end
  end

  describe "#sign_request" do
    adp_token = "{9wPSfh0zRvKQq6AvrDz3GMwfMBghMY+bHTsxau28WyATbnJ4WV3M13ZoX+e7FCwBidO933b1doseVesk6AIKUlOyuWHbbPZ5owpuYrefb7AYQvFGJiOI5YvMK+x8BzTzKtQ8vEMmU5SNfJttcNjhhqz5gqZ3EkQ2Ef3rhznmsk03pE7qCsFd/6vsusrpCnGoXqWkXvZ+mKpB1lDnOzR/L3ACERYiHvYM8QbkCZQa1kgG2O7hD5djEaMfYDub/jMwhu7uESdd/fAkPj1LGcfZ31e6xhwfDff0kZ1EiEbz6O0acRoj6uEy996anc0/WPUY14hqa7FuE5kSuLlppzHRBsPl/1GpOuAHAAST7m7UXBSylq2v6M64dU+tkF6rFyncZK/zOGKK/eMEv4GgxVwHCcIJeOArU53cGlCd6A86dgyAcvdWnt+yo0T9xIwhU6DyPlWEVoBXsZSKQRQQDJsK9Edjbf1ozZjt9RUVTpNH3sbY6nx1skDUE58p2Od2H4XIHtNqEpCiDs9gprYT5AVbpX0wCuO7KSBB5RmQH4uFhtpTlqOSw9GVyKvo1bXgMD6d9Tc78RqO+3FVKxTxtvVmhRQmG/rgrGSgqDITmkfXjCIznekVirCB7SP68W9DhJVjvgN0M0iHEfEpMiKEGKLtv8V4afcK1vfWX90c89UI4jHBXCSYmJzf29ZYeD0bH/ykql6k/3atvWPlG40wi7l3i3MpLDsYnXJxHxsMb83Tg49KtKGoTtemVaum5H3gsebR2bnlWd6fQUq5SGAbwarqapKgpOiy4twZmNDpAbdGu+w5Jj6SRDDXsOzYA1f57K3hSe8x+vsuUrR3MaRTTc+bV0fHqcWwP5FySN/ougudtCfd+ikLSeGoiWfvh/aoOjFG98Z42S2Gk+zsiE4Cf/08S0qJGOkVUVAdndoePwQRQAvYLcRhvR5C17W+vhtoQdz+8S9bMVfYn7pLiA+hoahwXpU2OrsQDjdSmqN+7S5azW0AKi6ATP/1pPU/EByTlrEPC6CvmGQGtMt7fY2IscBboQ==}{iv:072BWbEELkzH8UQRR3MzfQ==}{key:8HnETJjyaHxQt4eP874f4k/U7lMh8/ZRsMWYxjnzq2zJPebsLxovTkKqUiXiq6Xq+EfTSOROoLdwBmByoTGPFjG6ha/JeKw/3u3WM9DFRclK0csGBHGODW4+6MH6gVxc2iMTG2XD/dQ5pnC6gxPCpRGKVQJsVv9FAHb7teF1cGFg5jzY4iOEPkuWsNUuAcXdVFi8e24AdzkcO+43D2bYTz1INh3YLQ/cbST7NQLztV5nWz9wX00JL+stFNOwTFej7pnSLuzZ58gZ+ZtbNkkpPGYf0kANu+WDjoMqvMjYEgxfKLqRVq92gioQVs9KCnH27qHBQLXbzUzym3h7mIrPWQ==}{name:QURQVG9rZW5FbmNyeXB0aW9uS2V5}{serial:Mg==}"

    device_private_key = OpenSSL::RSA.new(<<-END_RSA_PRIVATE_KEY
    -----BEGIN RSA PRIVATE KEY-----
    MIIEpQIBAAKCAQEA3QZKS0pRp43+sQ1bvgA79KJ78lygI9DKSxG2Awh/S7vXzB1c
    IutSakbQcfSAN3gpfldWRfqfvmwk3hsec5u5OHr8tQwvR+BvxprxWsON1F54nPv0
    IbTpZtBpKQl61NffYSJlKZWat24/lQjzu2YIo2qVgApJCVy8CxPcjFpw4t0umwRS
    owbsyASi0sQ6fyLkTg0sEaTkroHrq7JeFpmt3/sQyG/gnDVLz7NDi1aRTUm9HnAc
    p4PZzJMBzpl7Xq6RxXqy9lLjOt0AW9i+gHgIqCrvOUljG386HPx0LRUUx5MjWHZ0
    STXc3tV1jAOhMl8JFvf/C2/vPoyRmDScTCPz7QIDAQABAoIBAACIaVlxHm1G/Fw0
    6gm1Om/GjIHzEzfC4xn3Ovca6COomkaVs4kqBBLZhNshecWodoEleMHGbugonpYi
    fppMv8+RDFbrZpnHwr051mcfnZHrgGLwgJAsPXvP+NDugutMce9sA85r2+mhTGnx
    kZTcFB1AvoeGftKU9KcaLyfvd+I0ISiRtekfjGNacOw1tAyGIl7Yl1o8In6iQAnG
    SjfmdYzpsz7jYtxn1VZdnoK1mcAPOHriqt7CCmU4Zp12mmwRx2f3+T7g2Ru7vl7x
    wSGFmmPsLMO+oR962HcxfW3HT+OHvSGuth9fbuUUw91WCh7O7ODew0C4EbtwVn4W
    NDuJT0ECgYEA+1LXB0Y9VWov6IS5edJurDrUGapLALlL41m3QLa0AYypKVTMTyLV
    w4zjmvzj2UaJBohx80dECFXgYLsvwE7N8x4/sbU0UCQ4lbP5gGN2ypL7fDTyhJny
    YU1/kV8CfdAtT6YXHcPwD4gPTbA83heaUFQsrogJbqI7UcJOEubTkFUCgYEA4SMf
    jg/kTp1MLeiSb0sxJkjA2foBNvc+qk41dI9oLvaPN4LRV3t9HQBzgSNUz0K/1tG0
    BqlOJuoQ3t2XSI3ubnRjKgAoUVYSbMgS9/6mpowrGGnG4ZHNvtLM4/160yvZabKg
    dsoLChNGPmDK4iLLtdoPKneJarleUpczyqBijTkCgYEA8HuGEgnd6ntfOEi4CZ+Y
    Eul/xscyWZD00qkoNp4chFcKDuh7T0Xv8dxAdi+B/ogF2eB52OXabXdu6mBzArrl
    SrspC2xukDj4hBbgqT+DjbczONiZLtT4Hq8/X+Tfx2+Jy+sLt4mjjdkNe7MlqwY+
    vJqu3pqBHAHUbRlWB7QjwLkCgYEAiPpXvpWIsRQfP2dbgP9cvhBR1c24Y3r206OV
    /n8qQjidVobvW6y0qKqXnCCk/x17nvYj9FGaTS7oaNCltO01/lot42YJIcOenjT0
    5ZI4TujFZ6sj6CZP6iRTqPuWeVkahKa73sp7APxNJrK5ffDxxIkR5SKppxd1fgak
    6km+7HECgYEA3X+mXrSiqLO6Dnd8dlenoQmGPNoNYkkxAjFIzYsXgzrktdufwz9B
    rKsXGe7JzjOIAg94Je9dnY5Ym/eG/VlgquCNqwOH/a8UcBr5wwpePYQ4B3y/RSku
    kDSGu2zzRAanGaPh2B2cjzVYWr1D3btW1Fn+nyuGtO0Dcdvq9EEwESc=
    -----END RSA PRIVATE KEY-----
    END_RSA_PRIVATE_KEY
    )

    date = Time.new(2016, 2, 15, 10, 20, 30).to_rfc3339 # => 2016-02-15T16:20:30Z

    it "signs GET request" do
      body = IO::Memory.new("")

      headers = sign_request("/0.0/library/books?purchaseAfterDate=01/01/1970", "GET", body, adp_token, device_private_key, date)
      headers["x-adp-token"].should eq(adp_token)
      headers["x-adp-alg"].should eq("SHA256withRSA:1.0")
      headers["x-adp-signature"].should eq("MLSyxJQdp8wr5XifjWU3gaQGWmhuma6WLUc5sSR4jkXoAaufPi5GmaXIK+rdSAQ7NF+PS4msOf11K2TdqrOaYmXSXGW4pFYzYaaPmTT+dYhZUQL/Fl4Kta9a6+Dg0b+dSVKMWswkHAOnjdb8gyXPc4hfpzoR96MlwP8Bqb9WyigQb4/r7G4FFrjeqepBCMb3elNvv1UlrwkY1TtLu1fKIAlDHW+TOkQweViapOJqjieM+H5UHnvcbPIzo0ePVyBeWVMPpsbgBNI7VR3Ecn9ClkXUvf+DziXfQb1D8e2udyQf3iT53KzU6ZxMRkbMzZy7MdNjpJr4r/OtmbRLwTJq+Q==:2016-02-15T16:20:30Z")
    end

    it "signs POST request" do
      body = IO::Memory.new(%({"asin": "B002V02KPU"}))
      headers = sign_request("/1.0/wishlist", "POST", body, adp_token, device_private_key, date)
      headers["x-adp-token"].should eq(adp_token)
      headers["x-adp-alg"].should eq("SHA256withRSA:1.0")
      headers["x-adp-signature"].should eq("YKyc3V3E3s96OHFY8WAxOTZtYMc5awjvFBDZRiY3jZbFGIq9YWrgocZ4Rxix8W1NrJk/L8rbeLqDlpeq8zUDopU/hfM8mfdAd308XV7qeekjxTLsz/52V5i6d3W4H/91cWqbQdko20iKpbAAW5BUBXJpb4pnt37BBZApiZ/rCyVdkO/XZFS8e0dW2fCgXlr/4B7rm6bBPXf6IK2nQffI4Qf0p5ByWoeFzHtIQDadi6KM6r7yzp5iTsOlxp/dCowKHtp7u+VxUoFIiMGdOqG8FLnPJsTftwy6XQenvyV+4HHOjbo+ue1pdAznxpQJvlE1cDnOGSIOt5jQUP7WZZemvg==:2016-02-15T16:20:30Z")
    end

    it "signs DELETE request" do
      body = IO::Memory.new("")

      headers = sign_request("/1.0/wishlist/B002V02KPU", "DELETE", body, adp_token, device_private_key, date)
      headers["x-adp-token"].should eq(adp_token)
      headers["x-adp-alg"].should eq("SHA256withRSA:1.0")
      headers["x-adp-signature"].should eq("tbM0YMdlpRY57Okw8KqgqfDbk/xYJKP6TFc90TWPbkh7TwTioRK+G6F/Lcai2BW6ddAxJAHfpW0+vlxLRSQ+RqAAYirS+D5hyu73Uo/h6CKnqm7cw2qneg0BOVjHdceoM6JMn0y0S4JKZ1CJAoNqYSdX/sJgXCwP+TK1JqUWKfa/5HoiICmm7QT0GqK9qfu0UTOCx7HOk6s6fbSA+6b/1GGhQjj10ez+s5OMe+RYOZ/SoxKla8vTvx1TABIa+ZVMvC07GOrLw8xhUeq/Kgm4Hq2IqGwH3raGQ2RHkHJxZ+k2UojcVkqCpC3hPFnTMVfQ67aj9JXtFvil8iD7lSgSOw==:2016-02-15T16:20:30Z")
    end
  end
end
